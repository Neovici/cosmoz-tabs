<link rel="import" href="../polymer/polymer.html">
<script>

/*global CosmozTabs*/
'use strict';

window.CosmozTabs = window.CosmozTabs || {};

/**
  @polymerBehavior CosmozTabs.BindParentChildBehavio
 */
CosmozTabs.BindParentChildBehavior = {
	/**
	 * Fired when binding a parent propery
	 *
	 * @event cosmoz-bind-parent-property
	 * @param  {Object} event.detail The event detail object
	 * @param  {HTMLElement} event.detail.element The element to bind
	 * @param  {String} event.detail.propertyName The name of the property
	 */

	/**
	 * Fired when unbinding a parent propery
	 *
	 * @event cosmoz-unbind-parent-property
	 * @param  {Object} event.detail The event detail object
	 * @param  {HTMLElement} event.detail.element The element to bind
	 * @param  {String} event.detail.propertyName The name of the property
	 */

	listeners: {
		'cosmoz-parent-property-changed': '_parentPropertyChanged'
	},


	/**
	 * Binds a parent property by firing a `cosmoz-bind-parent-property` event
	 * to a CosmozTabs.BindParentHostBehavior instance
	 *
	 * @param  {String} propertyName The name of the property
	 * @fires cosmoz-bind-parent-property
	 * @return {void}
	 */
	bindParentProperty: function (propertyName) {
		this._parentBoundProperties = this._parentBoundProperties || [];
		this._parentBoundProperties.push(propertyName);

		this.fire('cosmoz-bind-parent-property', {
			element: this,
			propertyName: propertyName
		}, {
			bubbles: true,
			cancelable: false
		});
	},

	/**
	 * Unbinds all parent properties
	 *
	 * @fires cosmoz-unbind-parent-property
	 * @return {void}
	 */
	detached: function () {
		var i,
			propertyName;

		if (!this._parentBoundProperties) {
			return;
		}

		for (i = 0; i < this._parentBoundProperties.length; i += 1) {
			propertyName = this._parentBoundProperties[i];
			this.fire('cosmoz-unbind-parent-property', {
				element: this,
				propertyName: propertyName
			}, {
				bubbles: true,
				cancelable: false
			});
		}

		this._parentBoundProperties = null;

	},

	/**
	 * Handles `cosmoz-parent-property-changed` event and
	 * sets the updated property
	 *
	 * @param  {Event} event The `cosmoz-parent-property-changed` event
	 * @param  {Object} event.detail The event detail object
	 * @param  {*} event.detail.value  The value of the property
	 * @param  {String} event.detail.propertyName The name of the property
	 * @listens cosmoz-bind-parent-property
	 * @return {void}
	 */
	_parentPropertyChanged: function (event) {
		var
			propertyName = event.detail.propertyName,
			setterName = '_set' + propertyName[0].toUpperCase() + propertyName.slice(1),
			setter = this[setterName];

		if (setter) {
			setter.call(this, event.detail.value);
		}
	}
};

</script>
