<link rel="import" href="../polymer/polymer.html">
<script>

/*global CosmozTabs, document, Polymer, window */
'use strict';

window.CosmozTabs = window.CosmozTabs || {};

/**
  @polymerBehavior
 */
CosmozTabs.BindParentHostBehavior = {

	listeners: {
		'cosmoz-bind-parent-property': '_onBindParentProperty',
		'cosmoz-unbind-parent-property': '_onUnbindParentProperty'
	},

	_onBindParentProperty: function (event) {
		var
			element = event.detail.element,
			propertyName = event.detail.propertyName,
			propertyBoundChildren;

		this._boundChildren = this._boundChildren || {};

		propertyBoundChildren = this._boundChildren[propertyName];

		if (!propertyBoundChildren) {
			propertyBoundChildren = [];
			this._boundChildren[propertyName] = propertyBoundChildren;

		}

		propertyBoundChildren.push(element);

		this._notifyChild(element, propertyName, this[propertyName]);

		event.stopPropagation();
	},

	_onUnbindParentProperty: function (event) {
		var
			element = event.detail.element,
			propertyName = event.detail.propertyName,
			propertyBoundChildren,
			i;

		if (!this._boundChildren) {
			return;
		}

		propertyBoundChildren = this._boundChildren[propertyName];

		if (propertyBoundChildren) {
			i = propertyBoundChildren.indexOf(element);
			if (i >= 0) {
				propertyBoundChildren.splice(i, 1);
			}
		}
		event.stopPropagation();
	},

	notifyBoundChildren: function (propertyName) {
		var propertyBoundChildren,
			i;
		if (!this._boundChildren) {
			return;
		}

		propertyBoundChildren = this._boundChildren[propertyName];
		for (i = 0; i < propertyBoundChildren.length; i += 1) {
			this._notifyChild(propertyBoundChildren[i], propertyName);
		}
	},

	_notifyChild: function (child, propertyName) {
		this.fire('cosmoz-parent-property-changed',
			{
				propertyName: propertyName,
				value: this[propertyName]
			}, {
				node: child,
				bubbles: false,
				cancelable: false
			});
	}

};

</script>
